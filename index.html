<script>
    // âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù€ API Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Direct Integration)
    const API_URL = 'https://instagram120.p.rapidapi.com/api/instagram/get';
    const API_KEY = 'c107978669msh8c9b80d11a0150dp1b0b56jsn6b0f9128b487';
    const API_HOST = 'instagram120.p.rapidapi.com';

    async function startDownload() {
        const urlInput = document.getElementById('urlInput');
        const resultDiv = document.getElementById('result');
        const btn = document.getElementById('downloadBtn');
        const url = urlInput.value.trim();

        if (!url) {
            alert("âŒ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø£ÙˆÙ„Ø§Ù‹!");
            return;
        }

        btn.disabled = true;
        btn.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬...";
        resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Instagram API...</div>';

        try {
            // ØªÙ†ÙÙŠØ° Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù€ API Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ Query Params
            const response = await fetch(`${API_URL}?url=${encodeURIComponent(url)}`, {
                method: 'GET',
                headers: {
                    'x-rapidapi-host': API_HOST,
                    'x-rapidapi-key': API_KEY
                }
            });

            if (!response.ok) throw new Error('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ API');

            const resData = await response.json();
            console.log("ğŸ“Š API Response:", resData);

            resultDiv.innerHTML = "";
            let mediaItems = [];

            // ğŸ› ï¸ Ø®Ø±ÙŠØ·Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø³ØªØ¬Ø§Ø¨Ø© instagram120
            // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„Ù€ API ØºØ§Ù„Ø¨Ø§Ù‹ ÙŠØ±Ø¬Ø¹ ÙÙŠØ¯ÙŠÙˆ Ø£Ùˆ ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
            if (resData) {
                // Ø­Ø§Ù„Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Reel/Video)
                if (resData.video_url || (resData.data && resData.data.video_url)) {
                    const vid = resData.video_url || resData.data.video_url;
                    const thumb = resData.thumbnail_url || (resData.data && resData.data.thumbnail_url);
                    mediaItems.push({ url: vid, type: 'video', thumbnail: thumb });
                } 
                // Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„ÙØ±Ø¯ÙŠØ©
                else if (resData.image_url || (resData.data && resData.data.image_url)) {
                    const img = resData.image_url || resData.data.image_url;
                    mediaItems.push({ url: img, type: 'image' });
                }
                // Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù„Ø¨ÙˆÙ… (Carousel)
                else if (resData.combined_media || (resData.data && resData.data.combined_media)) {
                    const items = resData.combined_media || resData.data.combined_media;
                    items.forEach(item => {
                        mediaItems.push({
                            url: item.video_url || item.image_url,
                            type: item.video_url ? 'video' : 'image',
                            thumbnail: item.image_url
                        });
                    });
                }
            }

            if (mediaItems.length > 0) {
                renderResults(mediaItems, resData);
            } else {
                throw new Error("Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±ÙˆØ§Ø¨Ø· ØªØ­Ù…ÙŠÙ„. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø§Ù….");
            }

        } catch (error) {
            resultDiv.innerHTML = `<div class="error-msg"><strong>âŒ Ø®Ø·Ø£:</strong> ${error.message}</div>`;
        } finally {
            btn.disabled = false;
            btn.innerHTML = "ğŸš€ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù†";
        }
    }

    function renderResults(items, fullData) {
        const resultDiv = document.getElementById('result');
        
        // Ø²Ø± Ø§Ù„ØªØ´Ø®ÙŠØµ (Debug)
        resultDiv.innerHTML = `
            <div class="debug-toggle" onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'">
                ğŸ”§ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù… (JSON)
            </div>
            <div class="debug-info" style="display: none;"><pre>${JSON.stringify(fullData, null, 2)}</pre></div>
            <div class="success-msg">âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ù…ÙŠÙ„!</div>
        `;

        items.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'media-card';
            const label = item.type === 'video' ? 'ÙÙŠØ¯ÙŠÙˆ ğŸ¬' : 'ØµÙˆØ±Ø© ğŸ“·';
            
            card.innerHTML = `
                <span class="media-type">${label}</span>
                <img src="${item.thumbnail || item.url}" class="preview-img">
                <a href="${item.url}" target="_blank" class="download-btn">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù†</a>
            `;
            resultDiv.appendChild(card);
        });
    }
</script>
